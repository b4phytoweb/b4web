<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manuale â€” B4PhytoWeb</title>
  <meta name="description" content="Manuale tecnico di installazione, configurazione e utilizzo delle API B4PhytoWeb.">
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<header class="nav">
  <div class="navbar">
    <a class="brand" href="index.html">
      <img src="assets/logo.svg" alt=""/>
      <span>B4PhytoWeb</span>
    </a>
    <div style="display:flex;gap:.5rem;align-items:center">
      <button class="menu-toggle" aria-label="Apri menu">â˜°</button>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="funzionalita.html">FunzionalitÃ </a></li>
        <li><a href="vantaggi.html">Vantaggi</a></li>
        <li><a href="origine.html">Origine</a></li>
        <li><a href="supporto.html">Supporto</a></li>
        <li><a href="manuale.html" class="active">Manuale</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- HERO -->
<section class="page-hero">
  <div class="wrap">
    <div>
      <span class="badge"><span class="dot"></span> Manuale</span>
      <h1>Manuale Tecnico di B4PhytoWeb</h1>
      <p>Installazione, configurazione, API, moduli interni ed ETL: tutto il necessario per sviluppatori e amministratori di sistema.</p>
    </div>
    <div class="illustration">
      <img src="assets/support.jpg" alt="manuale tecnico" loading="lazy"/>
    </div>
  </div>
</section>

<!-- ======================== -->
<!-- INSTALLAZIONE -->
<!-- ======================== -->

<section class="section">
  <div class="container card">
    <h2>ğŸ› ï¸ Installazione</h2>
    <p>Il backend puÃ² essere eseguito in locale, tramite Docker o distribuito su Kubernetes. Assicurarsi che il database PostgreSQL sia attivo e correttamente configurato.</p>

    <h3>ğŸ“„ Configurazione (.env)</h3>
    <pre><code>COMPOSE_PROJECT_NAME=b4web_backend_api
DB_HOST='host.docker.internal'
DB_USER='thisuser'
DB_PASSWORD='xxxxxyyyy123!'
DB_NAME='b4web'
APP_DOMAIN='localhost'
DB_PORT=5432
APP_PORT=8000
DB_DATA_PATH=b4web_db_data
admin_user='pippoAdmin'
admin_pass='pippoPW'
admin_email='pippo.disney@topolina.com'
SECRET_KEY='PIPPO_SECRET_KEY'
ALGORITHM='HS256'
SMTP_SERVER='smtp.disney.com'
SMTP_PORT=313
SMTP_USERNAME='disney-mail.blablablabla-0123456-yumyum'
SMTP_PASSWORD='plutoPW'
EMAIL_SENDER='DoNotReply@mailsend.disney.com'
ALLOWED_ORIGINS=http://localhost:3000
EXTTERNAL_ML_DATA_PATH='./external_ml_data'
</code></pre>

    <h3>â–¶ï¸ Esecuzione in locale</h3>
    <pre><code>uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --env-file .env
</code></pre>

    <h3>ğŸ³ Installazione su Docker</h3>
    <pre><code>docker-compose up --build -d
docker-compose down
</code></pre>

    <h3>â˜¸ï¸ Installazione su Kubernetes</h3>

    <h4>1. Namespace</h4>
    <pre><code>kubectl create namespace b4web
</code></pre>

    <h4>2. Secrets</h4>
    <pre><code>apiVersion: v1
kind: Secret
metadata:
  name: b4web-env-secrets
  namespace: b4web
type: Opaque
stringData:
  db-password: "xxxxyyyy123!"
  admin-pass: "pippoPW"
  smtp-password: "plutoPW"
  secret-key: "PIPPO_SECRET_KEY"
</code></pre>

    <h4>3. Deployment</h4>
    <pre><code>kubectl apply -f deployment.yml
</code></pre>

    <h4>4. Service</h4>
    <p>Espone lâ€™applicazione allâ€™interno del cluster Kubernetes.</p>

    <h4>5. Accesso</h4>
    <p>Per esposizione esterna utilizzare un Ingress Controller o LoadBalancer.</p>

  </div>
</section>

<!-- ======================== -->
<!-- ALLâ€™AVVIO DEL SERVER -->
<!-- ======================== -->

<section class="section">
  <div class="container">

    <h2>ğŸš€ Allâ€™avvio del server</h2>

    <p>Il main.py inizializza lâ€™app FastAPI, carica lâ€™ambiente, registra i router e avvia il server.</p>

    <h3>ğŸ§© Descrizione dei file principali</h3>

    <h4>ğŸ“„ main.py & models.py</h4>
    <ul>
      <li><strong>main.py</strong>: punto di ingresso FastAPI, include router, middleware e config.</li>
      <li><strong>models.py</strong>: definisce tutte le tabelle SQLAlchemy (utenti, metaboliti, bioassay, tassonomia, spettrometria...).</li>
    </ul>

    <h4>ğŸ“„ settings.py</h4>
    <p>Centralizza le variabili d'ambiente.</p>

    <h4>ğŸ“„ database_session.py</h4>
    <p>Gestione connessione DB, espone <code>get_db()</code> per dependency injection.</p>

    <h4>ğŸ“„ tableparams.py</h4>
    <p>Definisce parametri e modelli di input (metaboliti, bioassay, tassonomia, utenti...).</p>

    <h4>ğŸ”„ Come interagiscono</h4>
    <ol>
      <li>main.py â†’ avvio server</li>
      <li>settings.py â†’ lettura configurazione</li>
      <li>database_session.py â†’ connessione</li>
      <li>models.py â†’ strutture DB</li>
      <li>tableparams.py â†’ modelli di input</li>
      <li>routers â†’ API</li>
    </ol>

  </div>
</section>

<!-- ======================== -->
<!-- USER MANAGER -->
<!-- ======================== -->

<section class="section">
  <div class="container card">
    <h2>ğŸ‘¤ User Manager</h2>
    <p>Gestione completa utenti: OTP, login, reset password, ruoli, automazioni.</p>

    <h3>ğŸ” Flusso autenticazione</h3>
    <ul>
      <li>/request_access â†’ invio OTP</li>
      <li>/login â†’ login con password + OTP</li>
      <li>JWT token â†’ accesso alle rotte protette</li>
    </ul>

    <h3>ğŸ” Gestione Password</h3>
    <ul>
      <li>/change_password</li>
      <li>/reset_password</li>
    </ul>

    <h3>ğŸ‘¤ Gestione Utenti</h3>
    <ul>
      <li>/create_user</li>
      <li>/verify_email</li>
      <li>/get_list</li>
      <li>/delete/{id}</li>
      <li>/change_role</li>
    </ul>

  </div>
</section>

<!-- ======================== -->
<!-- API USERS -->
<!-- ======================== -->

<section class="section">
  <div class="container">

    <h2>ğŸŒ Endpoint APIusers.py</h2>
    <p>Endpoint FastAPI per autenticazione, accesso, gestione utenti, verifiche e ruoli.</p>

    <h3>ğŸ” Autenticazione e Accesso</h3>
    <ul>
      <li><strong>/request_access</strong>: richiede OTP</li>
      <li><strong>/login</strong>: login con OTP</li>
      <li>Token JWT</li>
    </ul>

    <h3>ğŸ” Gestione Password</h3>
    <ul>
      <li>/change_password</li>
      <li>/reset_password</li>
    </ul>

    <h3>ğŸ‘¤ Gestione Utenti</h3>
    <ul>
      <li>/create_user</li>
      <li>/verify_email</li>
      <li>/get_list</li>
      <li>/delete/{user_id}</li>
      <li>/change_role</li>
    </ul>

  </div>
</section>

<!-- ======================== -->
<!-- DATAMANAGER, CONNECTORS, ML -->
<!-- ======================== -->

<section class="section">
  <div class="container card">

    <h2>ğŸ“¦ DataManager</h2>

    <h3>ğŸŒ Endpoint APIdata.py</h3>
    <ul>
      <li>Modelli Request/Response</li>
      <li>Logiche interne</li>
      <li>Endpoint principali</li>
    </ul>

    <h3>ğŸ“ Script ETL principali</h3>
    <ul>
      <li>insert_metabolite.py</li>
      <li>insert_spectrometry.py</li>
      <li>insert_taxonomy.py</li>
      <li>insert_bioactivity.py</li>
      <li>metabolite_detail.py</li>
    </ul>

    <h2>ğŸ“¦ Connectors</h2>
    <h3>Da file Excel</h3>
    <ul>
      <li>POST /spectrometry_graph</li>
      <li>POST /add_bioactivity</li>
      <li>POST /add_taxonomy_and_sample</li>
      <li>POST /add_experimental_metabolite</li>
    </ul>

    <h3>Da PubChem</h3>
    <ul>
      <li>GET /get_metabolite_data</li>
      <li>GET /get_pubchem_taxonomy</li>
      <li>GET /get_pug_view_data</li>
      <li>GET /get_bioassays_from_cid</li>
      <li>GET /get_bioassays_from_aid</li>
    </ul>

    <h2>ğŸ“¦ Machine Learning</h2>
    <h3>Endpoint APImodel.py</h3>
    <p>Modelli ML e API predittivi.</p>

    <h3>match_ms2.py</h3>
    <ul>
      <li>matches_filters()</li>
      <li>find_ready_reference()</li>
      <li>load_spectra_from_json()</li>
      <li>generate_output()</li>
      <li>match_spectra()</li>
    </ul>

  </div>
</section>

<footer class="footer">
  <div class="cols container">
    <div>
      <div class="brand" style="margin-bottom:.5rem">
        <img src="assets/logo.svg" alt="" width="28" height="28"/>
        <span>B4PhytoWeb</span>
      </div>
      <p class="muted">
        B4Web: una tassonomia Biomolecolare delle Biofonti e delle BioattivitÃ  â€“ finanziato da Commissione Europea - Next Generation EU, Missione 4.
      </p>
    </div>
  </div>
</footer>

<script src="assets/script.js"></script>
</body>
</html>
