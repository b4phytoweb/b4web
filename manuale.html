<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manuale Tecnico â€” B4PhytoWeb</title>
  <meta name="description" content="Manuale tecnico completo di B4PhytoWeb.">
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">

  <style>
    /* Stile interno solo per toc e leggibilitÃ  */
    .toc {
      background: #f7f7f7;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid #e0e0e0;
    }
    .toc h2 {
      margin-top: 0;
    }
    .toc ul {
      list-style: none;
      padding-left: 0;
    }
    .toc ul li {
      margin: 6px 0;
    }
    .toc ul li a {
      text-decoration: none;
      color: #0060df;
      font-weight: 600;
    }
    .toc ul li a:hover {
      text-decoration: underline;
    }
    .section-content h2, 
    .section-content h3, 
    .section-content h4 {
      scroll-margin-top: 90px;
    }
  </style>
</head>

<body>

<header class="nav">
  <div class="navbar">
    <a class="brand" href="index.html" aria-label="B4PhytoWeb Home">
      <img src="assets/logo.svg" alt=""/>
      <span>B4PhytoWeb</span>
    </a>
    <div style="display:flex;gap:.5rem;align-items:center">
      <button class="menu-toggle" aria-label="Apri menu">â˜°</button>
    </div>
    <nav aria-label="Principale">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="funzionalita.html">FunzionalitÃ </a></li>
        <li><a href="vantaggi.html">Vantaggi</a></li>
        <li><a href="origine.html">Origine</a></li>
        <li><a href="supporto.html">Supporto</a></li>
        <li><a href="chi-siamo.html">Chi Siamo</a></li>
        <li><a href="lp-video.html"><span class="badge"><span class="dot"></span> Esplora</span></a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="page-hero">
  <div class="wrap">
    <div>
      <span class="badge"><span class="dot"></span> Manuale Tecnico</span>
      <h1>Manuale Tecnico B4PhytoWeb</h1>
      <p>Installazione, API, flussi ETL, modelli, autenticazione, interfacce e procedure.</p>
    </div>
    <div class="illustration">
      <img src="assets/support.jpg" alt="manuale" loading="lazy" />
    </div>
  </div>
</section>

<section class="section">
<div class="container section-content">

<!-- ========================= -->
<!-- INDICE CLICCABILE         -->
<!-- ========================= -->
<div class="toc">
  <h2>Indice</h2>
  <ul>
    <li><a href="#installazione">ğŸ› ï¸ Installazione</a></li>
    <li><a href="#avvio-server">ğŸš€ Allâ€™avvio del server</a></li>
    <li><a href="#files">ğŸ§© Descrizione dei file</a></li>
    <li><a href="#usermanager">ğŸ‘¤ UserManager</a></li>
    <li><a href="#apiusers">ğŸŒ Endpoint APIusers.py</a></li>
    <li><a href="#datamanager">ğŸ“¦ DataManager & ETL</a></li>
    <li><a href="#connectors">ğŸ“¦ Connectors</a></li>
    <li><a href="#machinelearning">ğŸ“¦ Machine Learning</a></li>
  </ul>
</div>

<!-- ========================= -->
<!-- INSTALLAZIONE             -->
<!-- ========================= -->
<h2 id="installazione">ğŸ› ï¸ INSTALLAZIONE</h2>

<p>Questo progetto puÃ² essere installato su Docker o Kubernetes.<br>
âš ï¸ Prima di iniziare, assicurarsi che il database sia avviato e configurato correttamente.</p>

<h3>ğŸ“„ Configurazione (.env)</h3>

<pre>
COMPOSE_PROJECT_NAME=b4web_backend_api
DB_HOST='host.docker.internal'
DB_USER='thisuser'
DB_PASSWORD='xxxxxyyyy123!'
DB_NAME='b4web'
APP_DOMAIN='localhost'
DB_PORT=5432
APP_PORT=8000
DB_DATA_PATH=b4web_db_data
admin_user='pippoAdmin'
admin_pass='pippoPW'
admin_email='pippo.disney@topolina.com'
SECRET_KEY='PIPPO_SECRET_KEY'
ALGORITHM='HS256'
SMTP_SERVER='smtp.disney.com'
SMTP_PORT=313
SMTP_USERNAME='disney-mail.blablablabla-0123456-yumyum'
SMTP_PASSWORD='plutoPW'
EMAIL_SENDER='DoNotReply@mailsend.disney.com'
ALLOWED_ORIGINS=http://localhost:3000
EXTTERNAL_ML_DATA_PATH='./external_ml_data'
</pre>

<h3>â–¶ï¸ Esecuzione in locale</h3>
<pre>
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --env-file .env
</pre>

<h3>ğŸ³ Installazione su Docker</h3>
<pre>docker-compose up --build -d</pre>
<pre>docker-compose down</pre>

<h3>â˜¸ï¸ Installazione su Kubernetes</h3>

<h4>1. Namespace</h4>
<pre>kubectl create namespace b4web</pre>

<h4>2. Secrets</h4>
<pre>
apiVersion: v1
kind: Secret
metadata:
  name: b4web-env-secrets
  namespace: b4web
type: Opaque
stringData:
  db-password: "xxxxyyyy123!"
  admin-pass: "pippoPW"
  smtp-password: "plutoPW"
  secret-key: "PIPPO_SECRET_KEY"
</pre>

<h4>3. Deployment</h4>
<pre>kubectl apply -f deployment.yml</pre>

<h4>4. Service</h4>
<pre>kubectl apply -f service.yml</pre>

<h4>5. Accesso</h4>
<p>
â€¢ Ingress Controller o LoadBalancer per accesso esterno<br>
â€¢ Impostare APP_DOMAIN, es: https://b4web-api.neodatagroup.ai<br>
â€¢ Accesso allo Swagger: https://b4web-api.neodatagroup.ai/docs<br>
</p>

<!-- ========================= -->
<!-- AVVIO SERVER              -->
<!-- ========================= -->
<h2 id="avvio-server">ğŸš€ ALLâ€™AVVIO DEL SERVER</h2>

<p>Quando lâ€™applicazione parte, FastAPI esegue:</p>
<ul>
  <li>Creazione FastAPI()</li>
  <li>Caricamento .env</li>
  <li>Configurazione CORS</li>
  <li>Registrazione router /users, /data, /conn</li>
  <li>Avvio uvicorn</li>
</ul>

<!-- ========================= -->
<!-- FILES                     -->
<!-- ========================= -->
<h2 id="files">ğŸ§© Descrizione dei file</h2>

<h3>ğŸ“„ main.py & models.py</h3>
<p>main.py gestisce avvio e routing.<br>models.py contiene tutte le tabelle SQLAlchemy.</p>

<h3>ğŸ“„ settings.py</h3>
<p>Gestione delle variabili ambiente.</p>

<h3>ğŸ“„ database_session.py</h3>
<p>Connessione al DB + get_db()</p>

<h3>ğŸ“„ tableparams.py</h3>
<p>Strutture dati per form/JSON/ETL.</p>

<h3>ğŸ”„ Interazioni</h3>
<ol>
  <li>main.py â†’ avvio</li>
  <li>settings.py â†’ configurazioni</li>
  <li>database_session â†’ dipendenze DB</li>
  <li>models.py â†’ tabelle</li>
  <li>tableparams â†’ input</li>
  <li>routers â†’ API</li>
  <li>datamanager â†’ ETL logiche</li>
  <li>usermanager â†’ utenti</li>
</ol>

<!-- ========================= -->
<!-- USERMANAGER               -->
<!-- ========================= -->
<h2 id="usermanager">ğŸ‘¤ UserManager</h2>

<p>Modulo dedicato a:</p>
<ul>
  <li>autenticazione</li>
  <li>gestione password</li>
  <li>OTP via email</li>
  <li>superuser</li>
  <li>scheduler pulizia OTP</li>
</ul>

<!-- ========================= -->
<!-- API USERS                 -->
<!-- ========================= -->
<h2 id="apiusers">ğŸŒ Endpoint APIusers.py</h2>

<h3>ğŸ” Autenticazione</h3>
<ul>
  <li>/request_access</li>
  <li>/login</li>
  <li>JWT token</li>
</ul>

<h3>ğŸ” Gestione Password</h3>
<ul>
  <li>/change_password</li>
  <li>/reset_password</li>
</ul>

<h3>ğŸ‘¤ Gestione Utenti</h3>
<ul>
  <li>/create_user</li>
  <li>/verify_email</li>
  <li>/get_list</li>
  <li>/delete/{id}</li>
  <li>/change_role</li>
</ul>

<!-- ========================= -->
<!-- DATAMANAGER ETL           -->
<!-- ========================= -->
<h2 id="datamanager">ğŸ“¦ DataManager & ETL</h2>

<p>Contiene:</p>
<ul>
  <li>insert_metabolite.py</li>
  <li>insert_spectrometry.py</li>
  <li>insert_taxonomy.py</li>
  <li>insert_bioactivity.py</li>
  <li>metabolite_detail.py</li>
  <li>index.py (ricerca)</li>
</ul>

<!-- ========================= -->
<!-- CONNECTORS                -->
<!-- ========================= -->
<h2 id="connectors">ğŸ“¦ Connectors</h2>

<h3>Da Excel</h3>
<ul>
  <li>POST /spectrometry_graph</li>
  <li>POST /add_bioactivity</li>
  <li>POST /add_taxonomy_and_sample</li>
  <li>POST /add_experimental_metabolite</li>
</ul>

<h3>Da PubChem</h3>
<ul>
  <li>GET /get_metabolite_data</li>
  <li>GET /get_pubchem_taxonomy</li>
  <li>GET /get_pug_view_data</li>
  <li>GET /get_bioassays_from_cid</li>
  <li>GET /get_bioassays_from_aid</li>
</ul>

<!-- ========================= -->
<!-- MACHINE LEARNING          -->
<!-- ========================= -->
<h2 id="machinelearning">ğŸ“¦ Machine Learning</h2>

<p>match_ms2.py:</p>

<ul>
  <li>matches_filters()</li>
  <li>find_ready_reference()</li>
  <li>load_spectra_from_json()</li>
  <li>generate_output()</li>
  <li>match_spectra()</li>
</ul>

</div>
</section>

<footer class="footer">
  <div class="cols container">
    <div>
      <div class="brand" style="margin-bottom:.5rem">
        <img src="assets/logo.svg" alt="" width="28" height="28"/>
        <span>B4PhytoWeb</span>
      </div>
      <p class="muted">
        B4Web â€” finanziato da: Commissione Europea - Next Generation EU
      </p>
    </div>

    <div>
      <h3>Sezioni</h3>
      <ul>
        <li><a href="funzionalita.html">FunzionalitÃ </a></li>
        <li><a href="vantaggi.html">Vantaggi</a></li>
        <li><a href="origine.html">Origine</a></li>
        <li><a href="supporto.html">Supporto</a></li>
        <li><a href="lp-video.html">Esplora</a></li>
      </ul>
    </div>

    <div class="footer-logos" style="display:flex;flex-wrap:wrap;gap:1rem;align-items:center;justify-content:flex-start">
      <img src="assets/20240209112418!LOGO_italiadomani.jpg" alt="Italia Domani" height="50" />
      <img src="assets/EN_Funded_by_the_European_Union_RGB_POS.png" alt="Finanziato dall'Unione Europea" height="50" />
      <img src="assets/LOGO_UniversitaRicerca.jpg" alt="Ministero UniversitÃ  e Ricerca" height="50" />
      <img src="assets/Logo_NBFC.png" alt="NBFC" height="50" />
    </div>
  </div>
</footer>

<script src="assets/script.js"></script>

</body>
</html>
